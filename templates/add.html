{% extends "base.html" %}
{% load bt %}
{% load i18n %}
{% block styles %}
  <link rel="stylesheet" type="text/css" media="all" href="{% media_url %}/css/jquery.autocomplete.css" />
{% endblock %}
{% block scripts %}
<script type="text/javascript" src="{%media_url%}/js/tinymce/tiny_mce.js"></script>
<script type="text/javascript" src="{%media_url%}/js/editor.js"></script>
<script type="text/javascript" src="{%media_url%}/js/jquery.1.4.2.min.js"></script>
<script type="text/javascript" src="{%media_url%}/js/jquery.autocomplete.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $(".fieldWrapper").hide();
    $('.help_text').hide();
    $(".fieldWrapper").hover(function(event) {$(this).find('.help_text').toggle();});
    $("#show_optionals").hide();
    $("#id_country").parent().show();
    $("#save_button").hide();
    $("#id_contractual").click(function(event) {
      $("#id_contract_excerpt_parent").parent().toggle();
    });
    $("#show_optionals").click(function(event) {
      $(this).hide();
      $("#optional .fieldWrapper").show();
      $("#id_contract_excerpt_parent").parent().hide();
    });
    $('#id_country').change(function() {
      var country=$(this).attr('value');
      if(country.length>0) {
        $('#id_operator').parent().show();
        $.getJSON('/ajax/'+country, function(data) {
          $("#id_operator").autocomplete(data, { minChars: 0, autoFill: true, });
        });
      }
    });
    $('#id_operator').change(function() {
      var country=$('#id_country').attr('value');
      var operator=$(this).val();
      if(operator.length>0) {
        $('#id_contract').parent().show();
        $.getJSON('/ajax/'+country+'/'+operator, function(data) {
          $("#id_contract").autocomplete(data,{ minChars: 0, });
        });
      }
    });
    $('#id_contract').change(function() {
      if($(this).val().length>0) {
        $('#id_comment').parent().show();
        $('#save_button').show();
        $("#show_optionals").show();
      }
    });
});
</script>
{% endblock %}

{%block content%}
  <h2>{% trans "New Violation" %}</h2>
<form id='addForm' name="addForm" action="{% root_url %}/add/" method="post">
  {% for field in form %}
      {% if field.label = 'Resource' %}<div id="show_optionals">Show expert details</div><div id="optional">{%endif%}
      <div class="fieldWrapper">
          {{ field.errors }}
          <div class="help_text">{{ field.help_text }}</div>
          {{ field.label_tag }} {{ field }}
      </div>
  {% endfor %}
  </div>
  {% csrf_token %}
  <input id="save_button" type="submit" value="{% trans "save" %}" />
</form>
{%endblock%}
